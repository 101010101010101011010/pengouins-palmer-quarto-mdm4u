---
title: Comprendre les pingouins Palmer
subtitle: Une analyse statistique de la physiologie pingouinale
format:
  pdf:
    include-in-header:
      - text: |
          \usepackage{xcolor}
      - macros.tex
toc: true
highlight-style: github
authors:
  - name: Nicolas Kmita
    affiliation: École secondaire Franco-Cité
bibliography: references.bib
nocite: |
  @*
notebook-links: false
---

```{r}
# Préparatipn de librairies et installations variés

# install.packages("palmerpenguins")
# install.packages("tidyverse")
# install.packages("languageserver")
# install.packages("ggbeeswarm")
# install.packages("viridis")

library(palmerpenguins)
library("tidyverse")
library(ggbeeswarm) # Génère des graphique d'essaim d'abeille
library(viridis) # Couleurs pouvant être mieux perçus

# citation()
# citation("palmerpenguins")
# citation("tidyverse")
# citation("ggbeeswarm")
```

```{r}
# Préparation aesthétique

theme_set(theme_classic())

# Échelle de couleur des pingouins Palmer
penguin_colours <- c("darkorange","purple","cyan4")
names(penguin_colours) <- levels(penguins$species)
penguin_colour_scale <- function(fill = FALSE) {
  if (fill) {
    return (scale_fill_manual(name = "Espèce", values = penguin_colours))
  }

  return (scale_colour_manual(name = "Espèce", values = penguin_colours))
}

# Utilisation d'une graine aléatoire déterminée
set.seed(3142)

```

MDM4U-01

M. Chabot

10 octobre 2024

{{< pagebreak >}}

## Variables

Il y a 8 variables dont les données ont été récoltés par la station Palmer:

### Espèce --- `species`

Une variable catégorique nominale dénotant nom de l'espèce du pingouin mesuré, soit \adelie{}, \chinstrap{} ou \gentoo{}.

### Isle --- `island`

Une variable catégorique nominale dénotant l'isle dans l'archipel Palmer sur laquelle vit le pingouin mesuré, soit `Biscoe`, `Dream` ou `Torgersen`.

### Longueur du bec (mm) --- `bill_length_mm`

Une variable numérique continue dénotant la longueur du bec du pingouin mesuré, en millimètres.

### Profondeur du bec (mm) --- `bill_depth_mm`

Une variable numérique continue dénotant la profondeur du bec du pingouin mesuré, en millimètres.

### Longueure de la nageoire (mm) --- `flipper_length_mm`

Une variable numérique continue, arrondie à l'unité près, dénotant la longueur de la nageoire du pingouin mesuré, en millimètres.

### Masse corporelle (g) --- `body_mass_g`

Une variable numérique continue, arrondie à l'unité près, dénotant la masse corporelle du pingouin mesuré, en grammes.

### Sexe --- `sex`

Une variable catégorique nominale dénotant le sexe du pingouin mesuré, soit `femelle` ou `mâle`.

### Année --- `year`

Une variable numérique *discrète, donnée à l'unité près, indiquant l'année de la prise de mesure du pingouin.

## Analyse

### Est-ce qu’il y a des valeurs manquantes?

### Est-ce qu’il y a des valeurs aberrantes?

### Quelle est le sommaire statistique de chaque variable?

o Qualitative : Fréquence, NA, mode.

o Quantitative :

### Min, moyenne, médiane, mode, max, quartiles, écart type.

```{r fig-violin-beclon, exho=FALSE, fig.cap='Longueurs de becs des pingouins Palmer, selon l\'espèce. Les barres rouges indiquent l\'allonge de l\'écart type, les lignes noires horizontales de chaque violon indiquent les quartiles, et les points rouges sont les moyennes.', out.width='100%', fig.align='center'}

sifted <-
  penguins %>%
  filter(
    !is.na(bill_length_mm)
  )

dfTab <- sifted %>% group_by(species) %>%
  summarize(
    y = max(bill_length_mm) + 1,
    mean = mean(bill_length_mm),
    sd = round(sd(bill_length_mm), digits = 2)
  )

ggplot(sifted) +
  # Diagrammes
  geom_violin(aes(species, bill_length_mm), staplewidth = 0.5, draw_quantiles = c(0.25, 0.5, 0.75)) +
  geom_quasirandom(aes(species, bill_length_mm, colour = sex), width = 0.3, alpha = 0.2) +

  # Écart type / barres d'érreure
  geom_errorbar(data=dfTab, aes(x=species, y=mean, ymin=mean-sd, ymax=mean+sd), width=.2, linewidth=.3, colour="red") +
  geom_point(data=dfTab, aes(x=species, y=mean), size=0.5, colour="red") +
  # Anotation de l'écart type
  geom_text(data=dfTab,aes(x=species,y=y,parse=FALSE,label=sprintf("s = %.2f", dfTab$sd)),vjust=0) +

  # Anotations
  scale_colour_discrete(labels = c("Femelle", "Mâle", "N/A")) +
  labs(
    title = "Longueurs de becs par rapport à l'espèce",
    x = "Espèce",
    y = "Longueur du bec (mm)",
    colour = "Sexe"
  )
```

```{r fig-violin-becprof, exho=FALSE, fig.cap='Profondeurs de becs des pingouins Palmer, selon l\'espèce. Les barres rouges indiquent l\'allonge de l\'écart type, les lignes noires horizontales de chaque violon indiquent les quartiles, et les points rouges sont les moyennes.', out.width='100%', fig.align='center'}

sifted <-
  penguins %>%
  filter(
    !is.na(bill_depth_mm)
  )

dfTab <- sifted %>% group_by(species) %>%
  summarize(
    y = max(bill_depth_mm) + 0.2,
    mean = mean(bill_depth_mm),
    sd = round(sd(bill_depth_mm), digits = 2)
  )

ggplot(sifted) +
  # Diagrammes
  geom_violin(aes(species, bill_depth_mm), staplewidth = 0.5, draw_quantiles = c(0.25, 0.5, 0.75)) +
  geom_quasirandom(aes(species, bill_depth_mm, colour = sex), width = 0.3, alpha = 0.2) +
  
  # Écart type / barres d'érreure
  geom_errorbar(data=dfTab, aes(x=species, y=mean, ymin=mean-sd, ymax=mean+sd), width=.2, linewidth=.3, colour="red") +
  geom_point(data=dfTab, aes(x=species, y=mean), size=0.5, colour="red") +
  # Anotation de l'écart type
  geom_text(data=dfTab,aes(x=species,y=y,parse=FALSE,label=sprintf("s = %.2f", dfTab$sd)),vjust=0) +

  # Anotations
  scale_colour_discrete(labels = c("Femelle", "Mâle", "N/A")) +
  labs(
    title = "Profondeurs de becs par rapport à l'espèce",
    x = "Espèce",
    y = "Profondeur du bec (mm)",
    colour = "Sexe"
  )
```

```{r fig-violin-nagelon, exho=FALSE, fig.cap='Longueurs de nageoires des pingouins Palmer, selon l\'espèce. Les barres rouges indiquent l\'allonge de l\'écart type, les lignes noires horizontales de chaque violon indiquent les quartiles, et les points rouges sont les moyennes.', out.width='100%', fig.align='center'}

sifted <-
  penguins %>%
  filter(
    !is.na(flipper_length_mm)
  )

dfTab <-
  sifted %>%
  group_by(
    species
  ) %>%
  summarize(
    y = max(flipper_length_mm) + 2,
    mean = mean(flipper_length_mm),
    sd = round(sd(flipper_length_mm), digits = 2)
  )

ggplot(sifted) +
  # Diagrammes
  geom_violin(aes(species, flipper_length_mm), staplewidth = 0.5, draw_quantiles = c(0.25, 0.5, 0.75)) +
  geom_quasirandom(aes(species, flipper_length_mm, colour = sex), width = 0.3, alpha = 0.2) +
  
  # Écart type / barres d'érreure
  geom_errorbar(data=dfTab, aes(x=species, y=mean, ymin=mean-sd, ymax=mean+sd), width=.2, linewidth=.3, colour="red") +
  geom_point(data=dfTab, aes(x=species, y=mean), size=0.5, colour="red") +
  # Anotation de l'écart type
  geom_text(data=dfTab,aes(x=species,y=y,parse=FALSE,label=sprintf("s = %.2f", dfTab$sd)),vjust=0) +

  # Thèmes
  penguin_colour_scale() +

  # Anotations
  scale_colour_discrete(labels = c("Femelle", "Mâle", "N/A")) +
  labs(
    title = "Longueurs de nageoires par rapport à l'espèce",
    x = "Espèce",
    y = "Longueure de la nageoire (mm)",
    colour = "Sexe"
  )
```

### Quelle île héberge le plus de pingouins?

L'île hébergeant le plus de pinguoins peut être estimée en manière d'un histogramme de fréquence, comme dans la @fig-freq-isle.

```{r fig-freq-isle, echo=FALSE, fig.cap='La fréquence des pingouins Palmer par île, selon les espèces, comparés entre-eux', out.width='100%', fig.align='center'}

sifted <-
 penguins

ggplot(sifted, aes(island)) +
  geom_histogram(stat="count", aes(fill = species), color = "black") +
  
  # Intervales
  scale_y_continuous(
    limits = c(0, 180),
    expand = c(0, 0),
    breaks = seq(from = 0, to = 180, by = 60),
    minor_breaks = seq(from = 0, to = 180, by = 10)
  ) +

  # Thèmes
  theme(
    panel.grid.major.y = element_line(color = "grey"),
    panel.grid.minor.y = element_line(color = "grey90"),
  ) +
  penguin_colour_scale(TRUE) +

  # Renomer tout
  labs(
    title = "Fréquence des îles de pingouins Palmer",
    x = "Île",
    y = "Fréquence",
    fill = "Espèce"
  )
```

```{r}
# Différences entre les fréquences de chaque île, à utiliser en-texte
bis_drea_isle_diff <- sum(penguins$island == "Biscoe") - sum(penguins$island == "Dream")
drea_torg_isle_diff <- sum(penguins$island == "Dream") - sum(penguins$island == "Torgersen")
```

L'île Biscoe comporte `{r} bis_drea_isle_diff` pingouins de plus que l'île Dream, qui en comporte `{r} drea_torg_isle_diff` de plus que l'île Torgersen. L'île Biscoe a donc une bonne avance sur les autres en terme de population de pingoins, toutefois ce pourrait aussi être que les autres îles n'ont pas eus autant de couvrage par l'équipe d'échantillonnage.

### Quelle est la relation entre les espèces et l’île?

### Quelles sont les relations entre le sexe, l’espèce et l’île?

### Quelle est la relation entre le sexe et la masse, et l’espèce et la masse?

En omettant les non valeurs de sexe et de poids

```{r fig-violin-masscats, exho=FALSE, fig.cap='Les masses corporelles, en kilogrammes, par rapport à l\'espèce et le sexe des pingouins Palmer', out.width='100%', fig.align='center'}

sifted <-
  penguins %>%
  mutate(
    body_mass_g = body_mass_g / 1000
  ) %>%
  filter(
    !is.na(body_mass_g) &
    !is.na(sex)
  )

dfTab <-
  sifted %>%
  group_by(
    species,
    sex
  ) %>%
  summarize(
    y = max(body_mass_g) + 0.1,
    mean = mean(body_mass_g),
    sd = round(sd(body_mass_g), digits = 2)
  )

dodgewidth <- 0.9

ggplot(sifted) +
  # Diagrammes
  geom_violin(aes(x=species, y=body_mass_g, color=sex), position=position_dodge(width=dodgewidth), staplewidth = 0.5, draw_quantiles = c(0.25, 0.5, 0.75)) +
  geom_quasirandom(aes(x=species, y=body_mass_g, colour=sex), dodge.width=dodgewidth, width = 0.12, alpha = 0.2) +

  # Écart type / barres d'érreure
  geom_errorbar(data=dfTab, aes(x=species, group=sex, y=mean, ymin=mean-sd, ymax=mean+sd), position=position_dodge(width=dodgewidth), width=.205, linewidth=.4, colour="black") +
  geom_point(data=dfTab, aes(x=species, group=sex, y=mean), position=position_dodge(width=dodgewidth), size=0.6, colour="black") +

  geom_errorbar(data=dfTab, aes(x=species, group=sex, y=mean, ymin=mean-sd, ymax=mean+sd), position=position_dodge(width=dodgewidth), width=.2, linewidth=.3, colour="red") +
  geom_point(data=dfTab, aes(x=species, group=sex, y=mean), position=position_dodge(width=dodgewidth), size=0.5, colour="red") +

  # Anotation de l'écart type
  geom_text(data=dfTab,aes(x=species, group=sex, y=y, parse=FALSE, label=sprintf("s = %.2f", dfTab$sd)), position=position_dodge(width=dodgewidth), vjust=0) +

  # Anotations
  scale_colour_discrete(labels = c("Femelle", "Mâle")) +
  labs(
    title = "Masses corporelles (kg) par rapport à l'espèce et le sexe",
    x = "Espèce",
    y = "Masse corporelle (kg)",
    colour = "Sexe"
  )
```

### Quelle est la relation entre les dimensions du bec et la dimension de la nageoire?

En comparant 

```{r fig-dots-becnage, echo=FALSE, fig.cap='La longueure de la nageoire pour la profondeur du bec, la longuer du bec et l\'espèce', out.width='100%', fig.align='center'}

sifted <-
  penguins %>%
  mutate(
    flipper_length_mm = flipper_length_mm / 10
  ) %>%
  filter(
    !is.na(flipper_length_mm) &
    !is.na(sex)
  )

dfTab <-
  sifted %>%
  group_by(species) %>%
  select(
    species,
    bill_length_mm,
    bill_depth_mm,
    flipper_length_mm
  ) %>%
  summarize(
    x = min((penguins %>% filter(!is.na(bill_length_mm)))$bill_length_mm) + ifelse(species == "Adelie", 0, ifelse(species == "Chinstrap", 10, 20)),
    y = max(bill_depth_mm) + 0.1,
    r = cor(bill_length_mm, bill_depth_mm),
    r2 = summary(lm(bill_depth_mm ~ bill_length_mm))$r.squared
  )

ggplot(sifted, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(aes(size = flipper_length_mm, colour = species), alpha = 0.2) +

  geom_smooth(method="lm",aes(color=species),se=TRUE, fill="grey80") +

  geom_text(data=dfTab,aes(color=species, label=sprintf("R^2 == %.2f", r2), x=x, y=24),parse=TRUE, hjust=0, vjust=1, show_guide=FALSE) +
  geom_text(data=dfTab,aes(color=species, label=sprintf("r == %.2f", r), x=x, y=23),parse=TRUE, hjust=0, vjust=1, show_guide=FALSE) +

  # Thèmes
  penguin_colour_scale() +

  # Renomer tout
  labs(
    title = "Longueure de la nageoire pour la profondeur\net longuer du bec et l'espèce",
    x = "Longueur du bec (mm)",
    y = "Profondeur du bec (mm)",
    colour = "Espèce",
    size = "Longueure de la\nnageoire (cm)"
  )
```

```{r fig-dots-longbecnage, echo=FALSE, fig.cap='La longueure de la nageoire pour la profondeur du bec, la longuer du bec et l\'espèce', out.width='100%', fig.align='center'}

sifted <-
  penguins %>%
  mutate(
    flipper_length_mm = flipper_length_mm / 10
  ) %>%
  filter(
    !is.na(bill_length_mm) &
    !is.na(flipper_length_mm)
  )

dfTab <-
  sifted %>%
  group_by(
    species
  ) %>%
  select(
    species,
    bill_length_mm,
    bill_depth_mm,
    flipper_length_mm
  ) %>%
  summarize(
    x = min((penguins %>% filter(!is.na(bill_length_mm)))$bill_length_mm) + ifelse(species == "Adelie", 0, ifelse(species == "Chinstrap", 10, 20)),
    y = max(bill_depth_mm) + 0.1,
    r = cor(bill_length_mm, bill_depth_mm),
    r2 = summary(lm(bill_depth_mm ~ bill_length_mm))$r.squared
  )

ggplot(sifted, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(aes(colour = species), alpha = 0.2) +

  geom_smooth(method="lm",aes(color=species),se=TRUE, fill="grey80") +

  geom_text(data=dfTab,aes(color=species, label=sprintf("R^2 == %.2f", r2), x=x, y=24),parse=TRUE, hjust=0, vjust=1, show_guide=FALSE) +
  geom_text(data=dfTab,aes(color=species, label=sprintf("r == %.2f", r), x=x, y=23),parse=TRUE, hjust=0, vjust=1, show_guide=FALSE) +

  # Thèmes
  penguin_colour_scale() +

  # Renomer tout
  labs(
    title = "Longueure de la nageoire pour la profondeur\net longuer du bec et l'espèce",
    x = "Longueur du bec (mm)",
    y = "Profondeur du bec (mm)",
    colour = "Espèce",
    size = "Longueure de la\nnageoire (cm)"
  )
```

### Est-ce qu’il y a des tendances temporelles?


{{< pagebreak >}}

## Références

::: {#refs}
:::